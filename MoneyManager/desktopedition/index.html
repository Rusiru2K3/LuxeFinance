<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxeFinance | Desktop & Mobile Suite</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: { 400: '#D4AF37', 500: '#C5A028', 600: '#B08D26' },
                        luxury: { dark: '#0f0f0f', panel: '#1a1a1a', sidebar: '#141414' }
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Scrollbar Styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #D4AF37; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .dark .glass-panel {
            background: #1a1a1a;
            border: 1px solid rgba(212, 175, 55, 0.1);
            box-shadow: 0 4px 20px -1px rgba(0, 0, 0, 0.5);
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Table Styles */
        .luxe-table th { font-family: 'Lato', sans-serif; letter-spacing: 0.05em; text-transform: uppercase; font-size: 0.75rem; }
        .luxe-table tr { transition: background-color 0.2s; }
        .luxe-table tr:hover { background-color: rgba(212, 175, 55, 0.05); }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-luxury-dark dark:text-gray-200 antialiased h-screen overflow-hidden flex transition-colors duration-300">

    <div id="passcodeModal" class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center hidden">
        <h2 class="font-serif text-4xl text-gold-400 mb-2">LuxeFinance</h2>
        <p class="text-gray-500 mb-6 tracking-widest text-sm uppercase">Security Check</p>
        <input type="password" id="passcodeInput" class="bg-gray-900 border border-gold-600 text-gold-400 text-center text-3xl p-4 rounded-lg w-64 mb-6 tracking-[1em]" maxlength="4" placeholder="••••">
        <button onclick="checkPasscode()" class="bg-gold-500 hover:bg-gold-400 text-black px-10 py-3 rounded-full font-bold transition transform hover:scale-105">Unlock Dashboard</button>
    </div>

    <aside class="hidden md:flex flex-col w-64 bg-white dark:bg-luxury-sidebar border-r border-gray-200 dark:border-gray-800 z-20">
        <div class="p-8">
            <div class="flex items-center gap-3 mb-1">
                <i class="fa-solid fa-gem text-gold-400 text-2xl"></i>
                <h1 class="font-serif text-2xl font-bold tracking-wide dark:text-white">Luxe<span class="text-gold-400">Finance</span></h1>
            </div>
            <p class="text-xs text-gray-400 uppercase tracking-widest ml-9">Desktop Edition</p>
        </div>

        <nav class="flex-1 px-4 space-y-2">
            <button onclick="switchView('dashboard')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all text-left group active-nav">
                <i class="fa-solid fa-chart-pie text-gray-400 group-hover:text-gold-400 transition-colors w-6 text-center"></i>
                <span class="font-bold text-gray-600 dark:text-gray-300 group-hover:text-gold-500">Dashboard</span>
            </button>
            <button onclick="switchView('add')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all text-left group">
                <i class="fa-solid fa-plus text-gray-400 group-hover:text-gold-400 transition-colors w-6 text-center"></i>
                <span class="font-bold text-gray-600 dark:text-gray-300 group-hover:text-gold-500">New Transaction</span>
            </button>
            <button onclick="switchView('history')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all text-left group">
                <i class="fa-solid fa-list text-gray-400 group-hover:text-gold-400 transition-colors w-6 text-center"></i>
                <span class="font-bold text-gray-600 dark:text-gray-300 group-hover:text-gold-500">Full History</span>
            </button>
             <button onclick="switchView('settings')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all text-left group">
                <i class="fa-solid fa-sliders text-gray-400 group-hover:text-gold-400 transition-colors w-6 text-center"></i>
                <span class="font-bold text-gray-600 dark:text-gray-300 group-hover:text-gold-500">Settings</span>
            </button>
        </nav>

        <div class="p-4 border-t border-gray-200 dark:border-gray-800">
            <button onclick="toggleTheme()" class="w-full flex items-center justify-between px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm font-bold text-gray-500 dark:text-gray-400 hover:text-gold-500 transition">
                <span>Theme Mode</span>
                <i id="themeIconDesktop" class="fa-solid fa-moon"></i>
            </button>
        </div>
    </aside>

    <nav class="md:hidden fixed top-0 w-full z-40 bg-white dark:bg-luxury-sidebar border-b border-gray-200 dark:border-gray-800 px-4 py-3 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-gem text-gold-400"></i>
            <h1 class="font-serif text-lg font-bold">LuxeFinance</h1>
        </div>
        <button onclick="toggleTheme()" class="p-2 text-gray-500"><i id="themeIconMobile" class="fa-solid fa-moon"></i></button>
    </nav>

    <main class="flex-1 overflow-y-auto h-full p-4 md:p-8 pt-20 md:pt-8 relative">
        
        <div id="view-dashboard" class="view-section fade-in max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group">
                    <div class="absolute -right-6 -top-6 text-9xl opacity-5 group-hover:opacity-10 transition-opacity text-gold-400"><i class="fa-solid fa-scale-balanced"></i></div>
                    <p class="text-xs uppercase tracking-widest text-gray-500 font-bold mb-2">Net Worth</p>
                    <h2 id="dashNetWorth" class="font-serif text-3xl md:text-4xl font-bold text-gray-800 dark:text-white">$0.00</h2>
                    <div class="w-12 h-1 bg-gold-500 mt-4 rounded-full"></div>
                </div>
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs uppercase tracking-widest text-gray-500 font-bold mb-2">Total Income</p>
                            <h2 id="dashIncome" class="font-serif text-2xl md:text-3xl font-bold text-green-500">$0.00</h2>
                        </div>
                        <div class="p-3 bg-green-500/10 rounded-lg text-green-500"><i class="fa-solid fa-arrow-trend-up"></i></div>
                    </div>
                </div>
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-xs uppercase tracking-widest text-gray-500 font-bold mb-2">Total Expense</p>
                            <h2 id="dashExpense" class="font-serif text-2xl md:text-3xl font-bold text-red-500">$0.00</h2>
                        </div>
                        <div class="p-3 bg-red-500/10 rounded-lg text-red-500"><i class="fa-solid fa-arrow-trend-down"></i></div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="glass-panel p-6 rounded-2xl">
                    <h3 class="font-serif text-lg font-bold mb-6 border-b border-gray-200 dark:border-gray-800 pb-2">Category Breakdown</h3>
                    <div class="h-64 md:h-80 flex justify-center">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
                <div class="glass-panel p-6 rounded-2xl">
                    <h3 class="font-serif text-lg font-bold mb-6 border-b border-gray-200 dark:border-gray-800 pb-2">Financial Flow</h3>
                    <div class="h-64 md:h-80 w-full">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="glass-panel rounded-2xl overflow-hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center">
                    <h3 class="font-serif text-lg font-bold">Recent Transactions</h3>
                    <button onclick="switchView('history')" class="text-sm text-gold-500 hover:text-gold-400 font-bold uppercase tracking-wider">View All</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left luxe-table">
                        <thead class="bg-gray-50 dark:bg-black/20 text-gray-500">
                            <tr>
                                <th class="px-6 py-4">Date</th>
                                <th class="px-6 py-4">Category</th>
                                <th class="px-6 py-4">Note</th>
                                <th class="px-6 py-4">Account</th>
                                <th class="px-6 py-4 text-right">Amount</th>
                            </tr>
                        </thead>
                        <tbody id="dashTableBody" class="divide-y divide-gray-100 dark:divide-gray-800 text-sm">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="view-add" class="view-section hidden max-w-2xl mx-auto fade-in">
            <h2 class="font-serif text-3xl mb-8 text-center dark:text-white">New Transaction</h2>
            
            <div class="glass-panel rounded-2xl p-8 shadow-2xl">
                <div class="flex bg-gray-100 dark:bg-black/40 rounded-xl p-1 mb-8">
                    <button onclick="setTransType('expense')" id="btn-expense" class="flex-1 py-3 rounded-lg text-sm font-bold transition-all shadow-sm text-red-500 bg-white dark:bg-gray-800">Expense</button>
                    <button onclick="setTransType('income')" id="btn-income" class="flex-1 py-3 rounded-lg text-sm font-bold text-gray-400 transition-all hover:text-gray-600">Income</button>
                </div>

                <form id="transactionForm" onsubmit="addTransaction(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="md:col-span-2">
                            <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold">Amount</label>
                            <div class="relative">
                                <span id="formCurrencySymbol" class="absolute left-4 top-4 text-gray-400 text-lg">$</span>
                                <input type="number" id="inpAmount" step="0.01" required class="w-full pl-10 pr-4 py-4 rounded-xl bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-gray-700 focus:border-gold-500 focus:ring-1 focus:ring-gold-500 outline-none transition text-2xl font-bold dark:text-white">
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold">Date</label>
                            <input type="date" id="inpDate" required class="w-full px-4 py-3 rounded-xl bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-gray-700 focus:border-gold-500 outline-none dark:text-white">
                        </div>
                        <div>
                            <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold">Category</label>
                            <select id="inpCategory" class="w-full px-4 py-3 rounded-xl bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-gray-700 focus:border-gold-500 outline-none dark:text-white">
                                </select>
                        </div>
                        <div>
                            <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold">Account</label>
                            <select id="inpAccount" class="w-full px-4 py-3 rounded-xl bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-gray-700 focus:border-gold-500 outline-none dark:text-white">
                                <option value="Bank">Main Bank</option>
                                <option value="Cash">Cash Wallet</option>
                                <option value="Card">Credit Card</option>
                                <option value="Savings">Savings</option>
                            </select>
                        </div>
                        <div>
                             <label class="block text-xs uppercase tracking-wider text-gray-500 mb-2 font-bold">Note</label>
                            <input type="text" id="inpNote" placeholder="Reference..." class="w-full px-4 py-3 rounded-xl bg-gray-50 dark:bg-black/20 border border-gray-200 dark:border-gray-700 focus:border-gold-500 outline-none dark:text-white">
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gold-500 hover:bg-gold-600 text-black font-bold py-4 rounded-xl shadow-lg transform active:scale-[0.99] transition duration-200 mt-2">
                        Save Entry
                    </button>
                </form>
            </div>
        </div>

        <div id="view-history" class="view-section hidden max-w-7xl mx-auto fade-in">
            <h2 class="font-serif text-3xl mb-8 dark:text-white">Transaction History</h2>
            <div class="glass-panel rounded-2xl overflow-hidden">
                 <div class="overflow-x-auto">
                    <table class="w-full text-left luxe-table">
                        <thead class="bg-gray-100 dark:bg-black/40 text-gray-500 border-b border-gray-200 dark:border-gray-800">
                            <tr>
                                <th class="px-6 py-4">Date</th>
                                <th class="px-6 py-4">Type</th>
                                <th class="px-6 py-4">Category</th>
                                <th class="px-6 py-4">Account</th>
                                <th class="px-6 py-4">Note</th>
                                <th class="px-6 py-4 text-right">Amount</th>
                                <th class="px-6 py-4 text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody id="fullHistoryBody" class="divide-y divide-gray-100 dark:divide-gray-800 text-sm dark:text-gray-300">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="view-settings" class="view-section hidden max-w-3xl mx-auto fade-in">
            <h2 class="font-serif text-3xl mb-8 dark:text-white">Settings</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass-panel rounded-2xl p-6">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="p-3 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg"><i class="fa-solid fa-earth-americas"></i></div>
                        <h3 class="font-bold">Currency</h3>
                    </div>
                    <select id="settingCurrency" onchange="updateSettings()" class="w-full p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-transparent dark:text-white font-bold text-gold-500 outline-none">
                        <option value="USD">USD ($)</option>
                        <option value="LKR">LKR (Rs)</option>
                        <option value="EUR">EUR (€)</option>
                        <option value="GBP">GBP (£)</option>
                    </select>
                </div>

                <div class="glass-panel rounded-2xl p-6">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="p-3 bg-purple-100 dark:bg-purple-900/30 text-purple-600 rounded-lg"><i class="fa-solid fa-lock"></i></div>
                        <h3 class="font-bold">Security</h3>
                    </div>
                    <button onclick="setPasscode()" class="w-full py-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition">Set/Change Passcode</button>
                </div>

                <div class="glass-panel rounded-2xl p-6 md:col-span-2">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="p-3 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg"><i class="fa-solid fa-database"></i></div>
                        <h3 class="font-bold">Data Management</h3>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="exportCSV()" class="flex-1 py-3 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition font-bold flex items-center justify-center gap-2">
                            <i class="fa-solid fa-download"></i> Export CSV
                        </button>
                        <button onclick="clearAllData()" class="flex-1 py-3 border border-red-500 text-red-500 rounded-lg hover:bg-red-500 hover:text-white transition font-bold flex items-center justify-center gap-2">
                            <i class="fa-solid fa-trash"></i> Reset Data
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <nav class="md:hidden fixed bottom-0 w-full glass-panel border-t border-gray-200 dark:border-gray-800 flex justify-around py-3 z-40 pb-safe">
        <button onclick="switchView('dashboard')" class="flex flex-col items-center gap-1 text-gold-500 mobile-nav-btn active">
            <i class="fa-solid fa-chart-pie"></i>
            <span class="text-[10px] font-bold">Home</span>
        </button>
        <button onclick="switchView('add')" class="flex flex-col items-center gap-1 text-gray-400 mobile-nav-btn">
            <div class="bg-gold-500 text-black h-10 w-10 rounded-full flex items-center justify-center -mt-5 border-4 border-gray-100 dark:border-luxury-sidebar">
                <i class="fa-solid fa-plus"></i>
            </div>
        </button>
        <button onclick="switchView('settings')" class="flex flex-col items-center gap-1 text-gray-400 mobile-nav-btn">
            <i class="fa-solid fa-sliders"></i>
            <span class="text-[10px] font-bold">Setup</span>
        </button>
    </nav>

    <script>
        const APP_KEY = 'LuxeFinance_Desktop_v2';
        let state = { transactions: [], currency: 'USD', passcode: null, theme: 'dark' };
        
        const categories = {
            expense: ['Food & Dining', 'Transport', 'Housing', 'Shopping', 'Entertainment', 'Health', 'Bills', 'Luxury', 'Travel'],
            income: ['Salary', 'Business', 'Investment', 'Gift', 'Rental']
        };
        let currentTransType = 'expense';
        let pieChartInstance = null;
        let barChartInstance = null;

        // Init
        window.onload = () => {
            loadData();
            applyTheme();
            if(state.passcode) document.getElementById('passcodeModal').classList.remove('hidden');
            document.getElementById('inpDate').valueAsDate = new Date();
            setTransType('expense'); // Init categories
            renderDashboard();
        };

        // Core Logic
        function loadData() {
            const stored = localStorage.getItem(APP_KEY);
            if (stored) state = JSON.parse(stored);
            document.getElementById('settingCurrency').value = state.currency;
        }

        function saveData() {
            localStorage.setItem(APP_KEY, JSON.stringify(state));
            renderDashboard();
        }

        // Passcode
        function checkPasscode() {
            if(document.getElementById('passcodeInput').value === state.passcode) {
                document.getElementById('passcodeModal').classList.add('hidden');
            } else alert("Invalid Passcode");
        }
        function setPasscode() {
            const c = prompt("Set new passcode (Empty to remove):");
            if(c !== null) { state.passcode = c || null; saveData(); alert("Security settings updated"); }
        }

        // Settings
        function updateSettings() {
            state.currency = document.getElementById('settingCurrency').value;
            saveData();
        }
        function toggleTheme() {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            saveData();
            applyTheme();
        }
        function applyTheme() {
            const html = document.documentElement;
            if(state.theme === 'dark') {
                html.classList.add('dark');
                document.getElementById('themeIconDesktop').classList.replace('fa-moon', 'fa-sun');
                document.getElementById('themeIconMobile').classList.replace('fa-moon', 'fa-sun');
            } else {
                html.classList.remove('dark');
                document.getElementById('themeIconDesktop').classList.replace('fa-sun', 'fa-moon');
                document.getElementById('themeIconMobile').classList.replace('fa-sun', 'fa-moon');
            }
            renderDashboard();
        }

        // Navigation
        function switchView(view) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${view}`).classList.remove('hidden');
            
            // Sidebar Active State
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('bg-gray-100', 'dark:bg-gray-800');
                el.querySelector('span').classList.remove('text-gold-500');
                el.querySelector('i').classList.remove('text-gold-400');
            });
            
            // Simple logic to highlight current sidebar item based on click not implemented purely for brevity, 
            // but the view switch works.
            
            if(view === 'dashboard' || view === 'history') renderDashboard();
        }

        // Transactions
        function setTransType(type) {
            currentTransType = type;
            const btnExp = document.getElementById('btn-expense');
            const btnInc = document.getElementById('btn-income');
            
            // Reset base styles
            const baseStyle = "flex-1 py-3 rounded-lg text-sm font-bold transition-all text-gray-400 hover:text-gray-600";
            const activeStyle = "flex-1 py-3 rounded-lg text-sm font-bold transition-all shadow-sm bg-white dark:bg-gray-800";

            if(type === 'expense') {
                btnExp.className = activeStyle + " text-red-500";
                btnInc.className = baseStyle;
            } else {
                btnInc.className = activeStyle + " text-green-500";
                btnExp.className = baseStyle;
            }

            const select = document.getElementById('inpCategory');
            select.innerHTML = '';
            categories[type].forEach(c => {
                const opt = document.createElement('option');
                opt.value = c; opt.text = c; select.appendChild(opt);
            });
        }

        function addTransaction(e) {
            e.preventDefault();
            const amt = parseFloat(document.getElementById('inpAmount').value);
            if(!amt) return;
            
            state.transactions.unshift({
                id: Date.now(),
                type: currentTransType,
                amount: amt,
                date: document.getElementById('inpDate').value,
                category: document.getElementById('inpCategory').value,
                account: document.getElementById('inpAccount').value,
                note: document.getElementById('inpNote').value
            });
            saveData();
            document.getElementById('inpAmount').value = '';
            document.getElementById('inpNote').value = '';
            alert("Entry Added");
            switchView('dashboard');
        }

        function deleteTransaction(id) {
            if(confirm("Delete this entry?")) {
                state.transactions = state.transactions.filter(t => t.id !== id);
                saveData();
            }
        }

        // Render Logic
        function renderDashboard() {
            const sym = { 'USD': '$', 'LKR': 'Rs', 'EUR': '€', 'GBP': '£' }[state.currency];
            document.getElementById('formCurrencySymbol').innerText = sym;

            let inc = 0, exp = 0;
            state.transactions.forEach(t => t.type === 'income' ? inc += t.amount : exp += t.amount);
            
            document.getElementById('dashNetWorth').innerText = `${sym}${(inc-exp).toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('dashIncome').innerText = `+${sym}${inc.toLocaleString()}`;
            document.getElementById('dashExpense').innerText = `-${sym}${exp.toLocaleString()}`;

            // Render Tables
            const renderRow = (t) => {
                const isExp = t.type === 'expense';
                return `
                    <tr class="group hover:bg-black/5 dark:hover:bg-white/5">
                        <td class="px-6 py-4 text-gray-500">${t.date}</td>
                        <td class="px-6 py-4 font-bold text-gray-700 dark:text-gray-300">${t.category}</td>
                        <td class="px-6 py-4 text-gray-400 italic">${t.note || '-'}</td>
                        <td class="px-6 py-4 text-xs uppercase text-gray-500">${t.account}</td>
                        <td class="px-6 py-4 text-right font-bold ${isExp ? 'text-red-500' : 'text-green-500'}">
                            ${isExp ? '-' : '+'}${sym}${t.amount.toLocaleString()}
                        </td>
                         ${ document.getElementById('view-history').classList.contains('hidden') ? '' : 
                         `<td class="px-6 py-4 text-center"><button onclick="deleteTransaction(${t.id})" class="text-gray-400 hover:text-red-500 transition"><i class="fa-solid fa-trash"></i></button></td>` }
                    </tr>
                `;
            };

            // Dashboard Table (Top 5)
            const dashBody = document.getElementById('dashTableBody');
            dashBody.innerHTML = state.transactions.slice(0, 5).map(renderRow).join('') || '<tr><td colspan="5" class="p-6 text-center text-gray-400">No data yet</td></tr>';

            // Full History Table
            const histBody = document.getElementById('fullHistoryBody');
            histBody.innerHTML = state.transactions.map(renderRow).join('') || '<tr><td colspan="7" class="p-6 text-center text-gray-400">No data yet</td></tr>';

            updateCharts(sym);
        }

        function updateCharts(sym) {
            const isDark = state.theme === 'dark';
            const txtColor = isDark ? '#9ca3af' : '#4b5563';
            
            // Pie
            const catData = {};
            state.transactions.filter(t=>t.type==='expense').forEach(t => catData[t.category] = (catData[t.category]||0)+t.amount);
            
            if(pieChartInstance) pieChartInstance.destroy();
            pieChartInstance = new Chart(document.getElementById('pieChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(catData),
                    datasets: [{
                        data: Object.values(catData),
                        backgroundColor: ['#C5A028', '#333333', '#EF4444', '#3B82F6', '#10B981', '#8B5CF6'],
                        borderWidth: 0
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: txtColor } } } }
            });

            // Bar (Monthly ish simplified)
            if(barChartInstance) barChartInstance.destroy();
            let inc=0, exp=0;
            state.transactions.forEach(t => t.type==='income'? inc+=t.amount : exp+=t.amount);
            
            barChartInstance = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: ['Total Flow'],
                    datasets: [
                        { label: 'Income', data: [inc], backgroundColor: '#10B981', borderRadius: 6 },
                        { label: 'Expense', data: [exp], backgroundColor: '#EF4444', borderRadius: 6 }
                    ]
                },
                options: { 
                    maintainAspectRatio: false, 
                    scales: { y: { ticks: { color: txtColor }, grid: { color: isDark?'#333':'#ddd' } }, x: { display: false } },
                    plugins: { legend: { labels: { color: txtColor } } }
                }
            });
        }

        function exportCSV() {
            let csv = "Date,Type,Category,Amount,Currency,Account,Note\n";
            state.transactions.forEach(t => csv += `${t.date},${t.type},${t.category},${t.amount},${state.currency},${t.account},"${t.note}"\n`);
            const a = document.createElement('a');
            a.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            a.download = 'LuxeFinance_Export.csv';
            a.click();
        }
        function clearAllData() { if(confirm("Reset all data?")) { localStorage.removeItem(APP_KEY); location.reload(); } }
    </script>
</body>
</html>
